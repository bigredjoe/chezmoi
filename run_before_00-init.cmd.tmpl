{{ if eq .chezmoi.os "windows" }}
@echo off
setlocal

REM Check if script has already run
set "STATE_DIR=%LOCALAPPDATA%\chezmoi\state"
set "STATE_FILE=%STATE_DIR%\init_complete"

if exist "%STATE_FILE%" (
    echo Windows initialization already completed.
    exit /b 0
)

echo Running Windows initialization script...

REM Enable Windows features
echo Enabling Windows features...
dism /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

REM Set execution policy for PowerShell scripts
echo Setting PowerShell execution policy...
powershell -Command "Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force"

REM Configure git
echo Configuring git...
git config --global core.autocrlf true
git config --global core.eol lf

REM Create state directory and file to mark completion
if not exist "%STATE_DIR%" mkdir "%STATE_DIR%"
echo %DATE% %TIME% > "%STATE_FILE%"

echo Windows initialization complete!
{{ end }} 